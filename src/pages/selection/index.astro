---
import Layout from "../../layouts/Layout.astro";
import "../../styles/global.css";
import IngredientGroup from "../../components/ingTypes/ingredientGroup.astro";
---

<Layout>
  <!-- Banner superior -->
  <section class="bg-gradient-to-r from-purple-100 to-indigo-100 py-8 mb-6 rounded-xl shadow-sm text-center">
    <h1 class="text-3xl font-bold text-purple-800">Elige tus ingredientes ü•ó</h1>
  </section>

  <form method="GET" action="/menu" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-8" id="ingredientForm">
    
    <!-- Mensajes de error -->
    <div id="errorMessages" class="hidden bg-red-50 border border-red-200 rounded-lg p-4">
      <h3 class="text-red-800 font-semibold mb-2">Se requieren m√°s ingredientes:</h3>
      <ul id="errorList" class="text-red-700 text-sm space-y-1"></ul>
    </div>

    <!-- Grid de ingredientes -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <IngredientGroup ingType_ID={1} title="vegetales" />
      <IngredientGroup ingType_ID={2} title="alimentos de origen animal" />
      <IngredientGroup ingType_ID={3} title="leguminosas" />
      <IngredientGroup ingType_ID={4} title="frutas" />
      <IngredientGroup ingType_ID={5} title="cereales" />
      <IngredientGroup ingType_ID={6} title="aceites y grasas" />
      <IngredientGroup ingType_ID={7} title="l√°cteos" />
      <IngredientGroup ingType_ID={8} title="grasas con prote√≠na" />
      <IngredientGroup ingType_ID={9} title="az√∫cares" />
    </div>

    <!-- Bot√≥n de env√≠o -->
    <div class="flex justify-center">
      <button
        type="submit"
        class="max-w-md w-full bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-full font-semibold transition text-sm sm:text-base"
      >
        Generar men√∫ con ingredientes disponibles
      </button>
    </div>
  </form>

  <!-- Validaci√≥n JS (sin cambios) -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('ingredientForm');
      const errorMessages = document.getElementById('errorMessages');
      const errorList = document.getElementById('errorList');

      const categoryNames = {
        1: 'Vegetales',
        2: 'Alimentos de origen animal',
        3: 'Leguminosas',
        4: 'Frutas',
        5: 'Cereales',
        6: 'Aceites y grasas',
        7: 'L√°cteos',
        8: 'Grasas con prote√≠na',
        9: 'Az√∫cares'
      };

      form.addEventListener('submit', function(e) {
        const errors = [];

        for (let categoryId = 1; categoryId <= 9; categoryId++) {
          const checkboxes = form.querySelectorAll(`input[name="ingredients"][data-category="${categoryId}"]:checked`);
          const smallGroups = [3, 7, 8];
          const minRequired = smallGroups.includes(categoryId) ? 2 : 7;

          if (checkboxes.length < minRequired) {
            const categoryName = categoryNames[categoryId];
            const remaining = minRequired - checkboxes.length;
            errors.push(`${categoryName}: necesitas ${remaining} ingrediente${remaining > 1 ? 's' : ''} m√°s (tienes ${checkboxes.length}/${minRequired})`);
          }
        }

        if (errors.length > 0) {
          e.preventDefault();
          errorList.innerHTML = '';
          errors.forEach(error => {
            const li = document.createElement('li');
            li.textContent = `‚Ä¢ ${error}`;
            errorList.appendChild(li);
          });
          errorMessages.classList.remove('hidden');
          errorMessages.scrollIntoView({ behavior: 'smooth', block: 'center' });
        } else {
          errorMessages.classList.add('hidden');
        }
      });
    });
  </script>
</Layout>